# Road Marking Detector API v2.0

API ัะตัะฒะธั ะดะปั ะฐะฝะฐะปะธะทะฐ ะดะพัะพะถะฝะพะน ัะฐะทะผะตัะบะธ ะฒ ะฒะธะดะตะพัะฐะนะปะฐั ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ ะฝะตะนัะพะฝะฝะพะน ัะตัะธ.

## ๐ ะะพะฒัะต ะฒะพะทะผะพะถะฝะพััะธ v2.0

- โ **ะะฝะฝะพัะธัะพะฒะฐะฝะฝะพะต ะฒะธะดะตะพ**: API ัะตะฟะตัั ัะพะทะดะฐะตั ะฒะธะดะตะพ ั ะฒัะดะตะปะตะฝะฝัะผะธ ะดะตัะตะบัะธัะผะธ
- โ **ะะฒะฐ ัะพัะผะฐัะฐ ะพัะฒะตัะฐ**: JSON-ัะพะปัะบะพ ะธะปะธ ZIP ั ะฒะธะดะตะพ + JSON
- โ **ะฃะปัััะตะฝะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ**
- โ **ะะพะดัะพะฑะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต**

## ะะฐะฟััะบ ัะตัะฒะธัะฐ

### 1. ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน

```bash
pip install -r requirements.txt
```

### 2. ะะฐะฟััะบ ัะตัะฒะตัะฐ

```bash
# ะะตะบะพะผะตะฝะดัะตะผัะน ัะฟะพัะพะฑ
python run_server.py

# ะะปััะตัะฝะฐัะธะฒะฝัะต ัะฟะพัะพะฑั
python app.py
uvicorn app:app --host 0.0.0.0 --port 8000 --reload
```

ะกะตัะฒะตั ะฑัะดะตั ะดะพัััะฟะตะฝ ะฟะพ ะฐะดัะตัั: http://localhost:8000

## API Endpoints

### POST /analyze-road-marking ๐ฅ

**ะัะฝะพะฒะฝะพะน endpoint** - ะฒะพะทะฒัะฐัะฐะตั ZIP ะฐััะธะฒ ั ะฐะฝะฝะพัะธัะพะฒะฐะฝะฝัะผ ะฒะธะดะตะพ ะธ JSON ัะตะทัะปััะฐัะฐะผะธ.

**ะะฐัะฐะผะตััั (form-data):**
- `video` (file): ะะธะดะตะพัะฐะนะป ะดะปั ะฐะฝะฐะปะธะทะฐ
- `lat1` (float): ะจะธัะพัะฐ ะฝะฐัะฐะปัะฝะพะน ัะพัะบะธ ะผะฐัััััะฐ
- `lon1` (float): ะะพะปะณะพัะฐ ะฝะฐัะฐะปัะฝะพะน ัะพัะบะธ ะผะฐัััััะฐ  
- `lat2` (float): ะจะธัะพัะฐ ะบะพะฝะตัะฝะพะน ัะพัะบะธ ะผะฐัััััะฐ
- `lon2` (float): ะะพะปะณะพัะฐ ะบะพะฝะตัะฝะพะน ัะพัะบะธ ะผะฐัััััะฐ
- `segment_length_m` (int, optional): ะะปะธะฝะฐ ัะตะณะผะตะฝัะฐ ะฒ ะผะตััะฐั (ะฟะพ ัะผะพะปัะฐะฝะธั: 10)

**ะัะฒะตั:** ZIP ัะฐะนะป ัะพะดะตัะถะฐัะธะน:
- `analysis_results.json` - ัะตะทัะปััะฐัั ะฐะฝะฐะปะธะทะฐ
- `annotated_[filename]` - ะฒะธะดะตะพ ั ะฒัะดะตะปะตะฝะฝัะผะธ ะดะตัะตะบัะธัะผะธ

**ะัะธะผะตั ะทะฐะฟัะพัะฐ (Postman/ApiDog):**
```
POST http://localhost:8000/analyze-road-marking
Content-Type: multipart/form-data

form-data:
โโโ video: [ะฒัะฑะตัะธัะต ะฒะธะดะตะพัะฐะนะป]
โโโ lat1: 55.996508
โโโ lon1: 92.792385
โโโ lat2: 55.995836
โโโ lon2: 92.785775
โโโ segment_length_m: 10
```

**ะัะธะผะตั ะทะฐะฟัะพัะฐ (curl):**
```bash
curl -X POST "http://localhost:8000/analyze-road-marking" \
     -F "video=@path/to/video.mp4" \
     -F "lat1=55.996508" \
     -F "lon1=92.792385" \
     -F "lat2=55.995836" \
     -F "lon2=92.785775" \
     -F "segment_length_m=10" \
     -o "result.zip"
```

### POST /analyze-road-marking-json ๐

**JSON-only endpoint** - ะฒะพะทะฒัะฐัะฐะตั ัะพะปัะบะพ ัะตะทัะปััะฐัั ะฐะฝะฐะปะธะทะฐ ะฒ JSON ัะพัะผะฐัะต (ะฑััััะตะต).

**ะะฐัะฐะผะตััั:** ัะต ะถะต, ััะพ ะธ ะฒััะต

**ะัะธะผะตั ะพัะฒะตัะฐ:**
```json
{
  "status": "success",
  "overall_stats": {
    "total_frames": 450,
    "total_distance_meters": 562.3,
    "segment_length_meters": 10,
    "total_segments": 57,
    "segments_with_data": 55,
    "average_coverage": 78.5
  },
  "segments": [
    {
      "segment_id": 1,
      "frames_count": 8,
      "coverage_percentage": 87.5,
      "has_data": true
    }
  ],
  "coordinates": {
    "start": {"lat": 55.996508, "lon": 92.792385},
    "end": {"lat": 55.995836, "lon": 92.785775}
  }
}
```

### GET /health โค๏ธ

ะัะพะฒะตัะบะฐ ัะพััะพัะฝะธั ัะตัะฒะธัะฐ.

**ะัะฒะตั:**
```json
{
  "status": "healthy",
  "model_loaded": true
}
```

### GET / โน๏ธ

ะะฝัะพัะผะฐัะธั ะพะฑ API ะธ ะดะพัััะฟะฝัั endpoints.

## ๐ง ะะฐัััะพะนะบะฐ ะฒ Postman/ApiDog

### ะัะฟัะฐะฒะปะตะฝะธะต ะฟัะพะฑะปะตะผั "Field required"

ะัะปะธ ะฒั ะฟะพะปััะฐะตัะต ะพัะธะฑะบั `"Field required"` ะดะปั ะฟะพะปั video:

1. **ะฃะฑะตะดะธัะตัั, ััะพ ะธัะฟะพะปัะทัะตัะต form-data**, ะฐ ะฝะต raw/JSON
2. **ะะปั ะฟะพะปั `video` ะฒัะฑะตัะธัะต ัะธะฟ "File"**, ะฐ ะฝะต "Text"
3. **ะะปั ะพััะฐะปัะฝัั ะฟะพะปะตะน ะธัะฟะพะปัะทัะนัะต ัะธะฟ "Text"**

### ะัะฐะฒะธะปัะฝะฐั ะฝะฐัััะพะนะบะฐ:

```
Method: POST
URL: http://localhost:8000/analyze-road-marking-json

Body > form-data:
โโโโโโโโโโโโโโโโโโโฌโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Key             โ Type โ Value                      โ
โโโโโโโโโโโโโโโโโโโผโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ video           โ File โ [Select Files...] โ       โ
โ lat1            โ Text โ 55.996508                  โ
โ lon1            โ Text โ 92.792385                  โ
โ lat2            โ Text โ 55.995836                  โ
โ lon2            โ Text โ 92.785775                  โ
โ segment_length_mโ Text โ 10                         โ
โโโโโโโโโโโโโโโโโโโดโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ ะขะตััะธัะพะฒะฐะฝะธะต

### ะะฒัะพะผะฐัะธัะตัะบะพะต ัะตััะธัะพะฒะฐะฝะธะต:
```bash
python test_api.py
```

### ะััะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต:

1. **ะะฐะฟัััะธัะต ัะตัะฒะตั**: `python run_server.py`
2. **ะัะพะฒะตัััะต ะทะดะพัะพะฒัะต**: GET `http://localhost:8000/health`
3. **ะขะตััะธััะนัะต JSON endpoint**: POST `http://localhost:8000/analyze-road-marking-json`
4. **ะขะตััะธััะนัะต ZIP endpoint**: POST `http://localhost:8000/analyze-road-marking`

## ๐ ะะฝัะตัะฐะบัะธะฒะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั

FastAPI ะฐะฒัะพะผะฐัะธัะตัะบะธ ะณะตะฝะตัะธััะตั ะดะพะบัะผะตะฝัะฐัะธั:
- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
road-detector-py/
โโโ app.py              # ะัะฝะพะฒะฝะพะต FastAPI ะฟัะธะปะพะถะตะฝะธะต v2.0
โโโ run_server.py       # ะกะบัะธะฟั ะดะปั ะทะฐะฟััะบะฐ ัะตัะฒะตัะฐ
โโโ test_api.py         # ะกะบัะธะฟั ะดะปั ัะตััะธัะพะฒะฐะฝะธั API
โโโ main.py             # ะัะธะณะธะฝะฐะปัะฝัะน ัะบัะธะฟั (ะดะปั ัะฟัะฐะฒะบะธ)
โโโ requirements.txt    # ะะฐะฒะธัะธะผะพััะธ Python
โโโ API_README.md       # ะญัะฐ ะดะพะบัะผะตะฝัะฐัะธั
โโโ ai/
โ   โโโ best.pt        # ะะฑััะตะฝะฝะฐั ะผะพะดะตะปั YOLO
โ   โโโ input/         # ะัะพะดะฝัะต ะฒะธะดะตะพัะฐะนะปั
โโโ output/            # ะััะพะดะฝัะต ัะฐะนะปั
```

## ๐ฏ ะัะพะฑะตะฝะฝะพััะธ ะฐะฝะฝะพัะธัะพะฒะฐะฝะฝะพะณะพ ะฒะธะดะตะพ

ะะฝะฝะพัะธัะพะฒะฐะฝะฝะพะต ะฒะธะดะตะพ ัะพะดะตัะถะธั:
- **Bounding boxes** ะฒะพะบััะณ ะพะฑะฝะฐััะถะตะฝะฝะพะน ัะฐะทะผะตัะบะธ
- **ะขะตะบััะพะฒัะต ะผะตัะบะธ** ั ะฝะพะผะตัะพะผ ะบะฐะดัะฐ ะธ ััะฐัััะพะผ ะพะฑะฝะฐััะถะตะฝะธั
- **ะฆะฒะตัะพะฒะพะต ะบะพะดะธัะพะฒะฐะฝะธะต**: 
  - ๐ข ะะตะปะตะฝัะน = ัะฐะทะผะตัะบะฐ ะพะฑะฝะฐััะถะตะฝะฐ
  - ๐ด ะัะฐัะฝัะน = ัะฐะทะผะตัะบะฐ ะฝะต ะพะฑะฝะฐััะถะตะฝะฐ

## โ๏ธ ะะฐะถะฝัะต ะฟัะธะผะตัะฐะฝะธั

- ะะพะดะตะปั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะณััะถะฐะตััั ะฟัะธ ััะฐััะต ัะตัะฒะธัะฐ
- ะะพะดะดะตัะถะธะฒะฐะตััั CUDA (ะตัะปะธ ะดะพัััะฟะฝะฐ), ะธะฝะฐัะต CPU
- ะัะตะผะตะฝะฝัะต ัะฐะนะปั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะดะฐะปััััั ะฟะพัะปะต ะพะฑัะฐะฑะพัะบะธ
- ะะพะดะดะตัะถะธะฒะฐัััั ัะฐะทะปะธัะฝัะต ัะพัะผะฐัั ะฒะธะดะตะพ (MP4, MOV, AVI, etc.)
- ะะพะพัะดะธะฝะฐัั ะดะพะปะถะฝั ะฑััั ะฒ ัะพัะผะฐัะต WGS84 (ะดะตัััะธัะฝัะต ะณัะฐะดััั)
- ะะฐะบัะธะผะฐะปัะฝัะน ัะฐะทะผะตั ะฒะธะดะตะพ ะพะณัะฐะฝะธัะตะฝ ะฝะฐัััะพะนะบะฐะผะธ FastAPI

## ๐จ ะะตัะตะฝะธะต ะฟัะพะฑะปะตะผ

### ะัะธะฑะบะฐ "Field required"
- ะัะฟะพะปัะทัะนัะต `form-data`, ะฐ ะฝะต `raw/JSON`
- ะะพะปะต `video` ะดะพะปะถะฝะพ ะฑััั ัะธะฟะฐ `File`

### ะัะธะฑะบะฐ "Model not found"
- ะฃะฑะตะดะธัะตัั, ััะพ ัะฐะนะป `ai/best.pt` ัััะตััะฒัะตั

### ะะตะดะปะตะฝะฝะฐั ะพะฑัะฐะฑะพัะบะฐ
- ะัะฟะพะปัะทัะนัะต endpoint `/analyze-road-marking-json` ะดะปั ะฑััััะพะณะพ ะฟะพะปััะตะฝะธั ัะพะปัะบะพ ัะตะทัะปััะฐัะพะฒ
- ะัะพะฒะตัััะต ะฝะฐะปะธัะธะต CUDA ะดะปั ััะบะพัะตะฝะธั

### ะะพะปััะพะน ัะฐะทะผะตั ZIP
- ะญัะพ ะฝะพัะผะฐะปัะฝะพ - ะฐััะธะฒ ัะพะดะตัะถะธั ะฟะพะปะฝะพะต ะฐะฝะฝะพัะธัะพะฒะฐะฝะฝะพะต ะฒะธะดะตะพ 